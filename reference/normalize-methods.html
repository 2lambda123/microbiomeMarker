<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Normalize the microbial abundance data — normalize,phyloseq-method • microbiomeMarker</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Normalize the microbial abundance data — normalize,phyloseq-method" />
<meta property="og:description" content="It is critical to normalize the feature table to eliminate any bias due to
differences in the sampling sequencing depth.This function implements six
widely-used normalization methods for microbial compositional data.
For rarefying, reads in the different samples are randomly removed until
the same predefined number has been reached, to assure all samples have the
same library size. Rarefying normalization method is the standard in
microbial ecology. Please note that the authors of phyloseq do not advocate
using this rarefying a normalization procedure, despite its recent
popularity
TSS simply transforms the feature table into relative abundance by dividing
the number of total reads of each sample.
CSS is based on the assumption that the count distributions in each sample
are equivalent for low abundant genes up to a certain threshold.  Only the
segment of each sample’s count distribution that is relatively invariant
across samples is scaled by CSS
RLE assumes most features are not differential and uses the relative
abundances to calculate the normalization factor.
TMM calculates the normalization factor using a robust statistics based on
the assumption that most features are not differential and should, in
average, be equal between the samples. The TMM scaling factor is  calculated
as the weighted mean of log-ratios between each pair of samples, after
excluding the highest count OTUs and OTUs with the largest log-fold change.
In CLR, the log-ratios are computed relative to the geometric mean of all
features.
norm_cpm: This normalization method is from the original LEfSe algorithm,
recommended when very low values are present (as shown in the LEfSe galaxy)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">microbiomeMarker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/microbiomeMarker-vignette.html">Tools for microbiome marker identification</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/yiluheihei/microbiomeMarker/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize the microbial abundance data</h1>
    <small class="dont-index">Source: <a href='https://github.com/yiluheihei/microbiomeMarker/blob/master/R/normalization.R'><code>R/normalization.R</code></a></small>
    <div class="hidden name"><code>normalize-methods.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>It is critical to normalize the feature table to eliminate any bias due to
differences in the sampling sequencing depth.This function implements six
widely-used normalization methods for microbial compositional data.</p>
<p>For rarefying, reads in the different samples are randomly removed until
the same predefined number has been reached, to assure all samples have the
same library size. Rarefying normalization method is the standard in
microbial ecology. Please note that the authors of phyloseq do not advocate
using this rarefying a normalization procedure, despite its recent
popularity</p>
<p>TSS simply transforms the feature table into relative abundance by dividing
the number of total reads of each sample.</p>
<p>CSS is based on the assumption that the count distributions in each sample
are equivalent for low abundant genes up to a certain threshold.  Only the
segment of each sample’s count distribution that is relatively invariant
across samples is scaled by CSS</p>
<p>RLE assumes most features are not differential and uses the relative
abundances to calculate the normalization factor.</p>
<p>TMM calculates the normalization factor using a robust statistics based on
the assumption that most features are not differential and should, in
average, be equal between the samples. The TMM scaling factor is  calculated
as the weighted mean of log-ratios between each pair of samples, after
excluding the highest count OTUs and OTUs with the largest log-fold change.</p>
<p>In CLR, the log-ratios are computed relative to the geometric mean of all
features.</p>
<p><code>norm_cpm</code>: This normalization method is from the original LEfSe algorithm,
recommended when very low values are present (as shown in the LEfSe galaxy).</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for phyloseq</span>
<span class='fu'>normalize</span><span class='op'>(</span><span class='va'>object</span>, method <span class='op'>=</span> <span class='st'>"TSS"</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for otu_table</span>
<span class='fu'>normalize</span><span class='op'>(</span><span class='va'>object</span>, method <span class='op'>=</span> <span class='st'>"TSS"</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for data.frame</span>
<span class='fu'>normalize</span><span class='op'>(</span><span class='va'>object</span>, method <span class='op'>=</span> <span class='st'>"TSS"</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for matrix</span>
<span class='fu'>normalize</span><span class='op'>(</span><span class='va'>object</span>, method <span class='op'>=</span> <span class='st'>"TSS"</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>norm_rarefy</span><span class='op'>(</span>
  <span class='va'>object</span>,
  size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fu'>sample_sums</span><span class='op'>(</span><span class='va'>object</span><span class='op'>)</span><span class='op'>)</span>,
  rng_seed <span class='op'>=</span> <span class='cn'>FALSE</span>,
  replace <span class='op'>=</span> <span class='cn'>TRUE</span>,
  trim_otus <span class='op'>=</span> <span class='cn'>TRUE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>

<span class='fu'>norm_tss</span><span class='op'>(</span><span class='va'>object</span><span class='op'>)</span>

<span class='fu'>norm_css</span><span class='op'>(</span><span class='va'>object</span>, sl <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span>

<span class='fu'>norm_rle</span><span class='op'>(</span>
  <span class='va'>object</span>,
  locfunc <span class='op'>=</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/r/stats/median.html'>median</a></span>,
  type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/S4Vectors/man/Vector-class.html'>c</a></span><span class='op'>(</span><span class='st'>"poscounts"</span>, <span class='st'>"ratio"</span><span class='op'>)</span>,
  geo_means <span class='op'>=</span> <span class='cn'>NULL</span>,
  control_genes <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>norm_tmm</span><span class='op'>(</span>
  <span class='va'>object</span>,
  ref_column <span class='op'>=</span> <span class='cn'>NULL</span>,
  logratio_trim <span class='op'>=</span> <span class='fl'>0.3</span>,
  sum_trim <span class='op'>=</span> <span class='fl'>0.05</span>,
  do_weighting <span class='op'>=</span> <span class='cn'>TRUE</span>,
  Acutoff <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1e+10</span>
<span class='op'>)</span>

<span class='fu'>norm_clr</span><span class='op'>(</span><span class='va'>object</span><span class='op'>)</span>

<span class='fu'>norm_cpm</span><span class='op'>(</span><span class='va'>object</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>a <a href='https://rdrr.io/pkg/phyloseq/man/phyloseq-class.html'>phyloseq::phyloseq</a> or <a href='https://rdrr.io/pkg/phyloseq/man/otu_table-class.html'>phyloseq::otu_table</a></p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>the methods used to normalize the microbial abundance data.
Options includes:</p><ul>
<li><p>"none": do not normalize.</p></li>
<li><p>"rarefy": random subsampling counts to the smallest library size in the
data set.</p></li>
<li><p>"TSS": total sum scaling, also referred to as "relative abundance", the
abundances were normalized by dividing the corresponding sample library
size.</p></li>
<li><p>"TMM": trimmed mean of m-values. First, a sample is chosen as reference.
The scaling factor is then derived using a weighted trimmed mean over
the differences of the log-transformed gene-count fold-change between
the sample and the reference.</p></li>
<li><p>"RLE", relative log expression, RLE uses a pseudo-reference calculated
using the geometric mean of the gene-specific abundances over all
samples. The scaling factors are then calculated as the median of the
gene counts ratios between the samples and the reference.</p></li>
<li><p>"CSS": cumulative sum scaling, calculates scaling factors as the
cumulative sum of gene abundances up to a data-derived threshold.</p></li>
<li><p>"CLR": centered log-ratio normalization.</p></li>
<li><p>"CPM": pre-sample normalization of the sum of the values to 1e+06.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other arguments passed to the corresponding normalization
methods.</p></td>
    </tr>
    <tr>
      <th>size, rng_seed, replace, trim_otus, verbose</th>
      <td><p>extra arguments passed to
<code><a href='https://rdrr.io/pkg/phyloseq/man/rarefy_even_depth.html'>phyloseq::rarefy_even_depth()</a></code>.</p></td>
    </tr>
    <tr>
      <th>sl</th>
      <td><p>The value to scale.</p></td>
    </tr>
    <tr>
      <th>locfunc</th>
      <td><p>a function to compute a location for a sample. By default,
the median is used.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>method for estimation: either "ratio"or "poscounts" (recommend).</p></td>
    </tr>
    <tr>
      <th>geo_means</th>
      <td><p>default <code>NULL</code>, which means the geometric means of the
counts are used. A vector of geometric means from another count matrix can
be provided for a "frozen" size factor calculation.</p></td>
    </tr>
    <tr>
      <th>control_genes</th>
      <td><p>default <code>NULL</code>, which means all taxa are used for size
factor estimation, numeric or logical index vector specifying the taxa
used for size factor estimation (e.g. core taxa).</p></td>
    </tr>
    <tr>
      <th>ref_column</th>
      <td><p>column to use as reference</p></td>
    </tr>
    <tr>
      <th>logratio_trim</th>
      <td><p>amount of trim to use on log-ratios</p></td>
    </tr>
    <tr>
      <th>sum_trim</th>
      <td><p>amount of trim to use on the combined absolute levels
("A" values)</p></td>
    </tr>
    <tr>
      <th>do_weighting</th>
      <td><p>whether to compute the weights or not</p></td>
    </tr>
    <tr>
      <th>Acutoff</th>
      <td><p>cutoff on "A" values to use before trimming</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>the same class with <code>object</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/edgeR/man/calcNormFactors.html'>edgeR::calcNormFactors()</a></code>,<code><a href='https://rdrr.io/pkg/DESeq2/man/estimateSizeFactorsForMatrix.html'>DESeq2::estimateSizeFactorsForMatrix()</a></code>,
<code><a href='https://rdrr.io/pkg/metagenomeSeq/man/cumNorm.html'>metagenomeSeq::cumNorm()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/phyloseq/man/rarefy_even_depth.html'>phyloseq::rarefy_even_depth()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/metagenomeSeq/man/calcNormFactors.html'>metagenomeSeq::calcNormFactors()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/DESeq2/man/estimateSizeFactorsForMatrix.html'>DESeq2::estimateSizeFactorsForMatrix()</a></code></p>
<p><code><a href='https://rdrr.io/pkg/edgeR/man/calcNormFactors.html'>edgeR::calcNormFactors()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>caporaso</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'>normalize</span><span class='op'>(</span><span class='va'>caporaso</span>, <span class='st'>"TSS"</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Also defined by ‘tidytree’</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Also defined by ‘tidytree’</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Also defined by ‘tidytree’</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Also defined by ‘tidytree’</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> phyloseq-class experiment-level object</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> otu_table()   OTU Table:         [ 3426 taxa and 34 samples ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> sample_data() Sample Data:       [ 34 samples by 8 sample variables ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> tax_table()   Taxonomy Table:    [ 3426 taxa by 7 taxonomic ranks ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> phy_tree()    Phylogenetic Tree: [ 3426 tips and 3424 internal nodes ]</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Yang Cao.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


